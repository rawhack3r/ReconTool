import subprocess
import os
import time

def run(urls, output_dir):
    if not urls:
        return []
    
    output_file = os.path.join(output_dir, "zap.json")
    first_url = urls[0]
    
    # Start ZAP in daemon mode
    subprocess.Popen(["zap.sh", "-daemon"], stdout=subprocess.DEVNULL)
    time.sleep(30)  # Wait for ZAP to start
    
    # Run scan
    cmd = f"zap-cli quick-scan -s all -r {output_file} {first_url}"
    try:
        subprocess.run(cmd, shell=True, timeout=3600)
        return ["ZAP scan completed"]
    except:
        return []