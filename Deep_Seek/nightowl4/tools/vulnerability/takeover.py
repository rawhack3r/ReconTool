import requests
from core.utils import NightOwlUtils

utils = NightOwlUtils()

def run_takeover(target, output_dir, state, verbose=False):
    if not state.get("subdomains"):
        return []
    
    vulnerable = []
    for subdomain in state["subdomains"]:
        try:
            response = requests.get(f"http://{subdomain}", timeout=5)
            if response.status_code == 404 and "404 Not Found" in response.text:
                vulnerable.append(subdomain)
        except:
            continue
    
    with open(f"{output_dir}/vulns/takeover.txt", "w") as f:
        f.write("\n".join(vulnerable))
    
    return vulnerable