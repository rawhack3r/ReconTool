from core.utils import NightOwlUtils

utils = NightOwlUtils()

def run_testssl(target, output_dir, state, verbose=False):
    if not state.get("live_urls"):
        return []
    
    results = []
    for url in state["live_urls"]:
        if not url.startswith("https://"):
            continue
        domain = url.replace("https://", "")
        output_file = f"{output_dir}/vulns/testssl_{domain}.txt"
        cmd = f"testssl.sh --quiet --color 0 {domain} > {output_file}"
        results.extend(utils.run_command(cmd, verbose=verbose))
    
    return results