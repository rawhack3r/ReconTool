from core.utils import NightOwlUtils

utils = NightOwlUtils()

def run_wpscan(target, output_dir, state, verbose=False):
    wp_sites = [url for url in state["live_urls"] if "wp-content" in url]
    if not wp_sites:
        return []
    
    results = []
    for site in wp_sites:
        output_file = f"{output_dir}/vulns/wpscan_{site.replace('://', '_')}.txt"
        cmd = f"wpscan --url {site} --output {output_file}"
        results.extend(utils.run_command(cmd, verbose=verbose))
    
    return results